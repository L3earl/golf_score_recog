## 전체 프로세스 흐름
시스템은 아래와 같은 순서로 작동하며, TrOCR(로컬 OCR) 파이프라인과 Claude(LLM) 파이프라인 두 가지를 모두 고려하고 있습니다.

[이미지 입력]
    |
    ▼
[1. 전처리] : 이미지 자르기(crop) → 얼룩 제거(clean)
    |
    ▼
[2. OCR 변환] : 전처리된 이미지를 TrOCR 모델로 텍스트 변환
    |
    ▼
[3. 후처리] : 빈 행 제거, Sum 계산해서 넣어줌 (변환 과정에서 sum값 중에 100이 넘는 것들은 인식을 못하는 경우가 있음)
    |
    ▼
[4. 데이터 검증 (1차)] : 숫자 인식 못한 경우, 전체 타수와 total의 계산이 불일치하는 경우, 모든 숫자를 인식 못해서 플레이어가 없는 경우 등 예외 케이스 처리
    |
    ▼
[5. Claude 변환] : 예외 파일들만 원본 이미지를 Claude API로 CSV 형식으로 재변환
    |
    ▼
[6. 최종 결과] : 처리 완료 및 결과 요약
<hr/>

## 실행을 위해 해야 하는 것
- 맨 위 폴더에 .env 파일 만들고 ANTHROPIC_API_KEY = API_KEY 넣어주셔야 함

- requirement에 있는 라이브러리들 설치가 필요함. 특히 머신러닝 모델을 쓰려면 torch 라이브러리들이 필요합니다. [제가 한 방법](https://earls.notion.site/119abb83012043159fee15b3c73235cc?pvs=74) 들어가셔서 환경설정> 윈도우 자체에 CUDA 설치 > 1번 부터 참고하시면 됩니다 (window일시)

    

## 테스트 남은 이슈
- 현황: '이글' 표시와 같은 얼룩이 있는 숫자를 인식시키기 위해, 검은색 외의 모든 색상을 제거하는 전처리 로직이 적용되어 있습니다.
 
필요 작업: 현재 -1 케이스만 테스트된 상태입니다. 버디(새), 더블보기(네모) 등 다른 종류의 아이콘이나 얼룩이 있는 경우에도 이 로직이 유효한지 다양한 케이스에 대한 테스트가 필요합니다.

필요 작업: -1 외에 -2, -3, -4 등 다른 음수 값도 정확히 인식하는지 테스트가 필요합니다.

필요 작업: Claude API의 CSV 형식 응답이 다양한 스코어카드 레이아웃에서 일관되게 작동하는지 검증이 필요합니다.
 

## 주요 이슈
- GPU가 필요합니다. CPU로는 속도가 나지 않음

현재 매 처리마다 모델을 GPU 메모리에 로드하고 있습니다. 이 시간이 전체 시간의 50% 정도를 차지합니다. 실제 서비스에서는 모델을 한 번만 GPU 메모리에 올린 후, 여러 요청을 메모리 상에서 계속 처리하도록 아키텍처를 변경해야 합니다.

- TrOCR 모델 한계점 : microsoft/trocr-large-printed 모델은 숫자 인식률이 높지만, 세 자릿수 숫자('100' 이상)를 인식하지 못하는 문제가 있습니다.

임시 해결책: 세 자릿수는 주로 'SUM' 열에만 등장하므로, 현재는 SUM 열의 데이터를 사용하지 않는 방식으로 우회하고 있습니다.

- LLM 프롬프트 최적화

필요 작업: 스코어카드의 양식(앱 종류, 레이아웃 등)이 다양하므로, 현재 프롬프트가 특정 케이스에서는 최적이 아닐 수 있습니다. 여러 종류의 이미지에 일관적으로 높은 성능을 내는 범용 프롬프트를 찾는 연구 및 테스트가 필요합니다.

- 모든 프로세스를 통과하지 못 한 경우, 어떻게 할지 얘기해봐야 함

- debug위한 코드들 지워야 함